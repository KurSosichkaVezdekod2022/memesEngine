# Решение команды "кыр сосичка" на финал Вездекода 2022 в категории tarantool
Задание: https://vk.com/@vezdekod-tarantool-2022-45613

## API
По умолчанию работает на 5000 порте
### set
У метода сет есть три реализации, соответствующие условию со следующими curl-интерфейсами:
1) ```curl -X POST "http://5.188.140.113:5000/set?up_text=[text]&low_text=[text]" -T [file]``` -> `Id`
2) ```curl -X POST "http://5.188.140.113:5000/set?up_text=[text]&low_text=[text]"``` -> `Id`
3) ```curl -X POST "http://5.188.140.113:5000/set" -T [file]``` -> `Id`

Где `up_text` -- текст сверху картинки, `low_text` -- текст в нижней части картинки, `Id` -- id созданной, или требуемой в условии картинки

### get 

1) ```curl -X GET "http://5.188.140.113:5000/set?id=[id]"``` -> `Binary data (Image)`

### clear 
`
1)  ```curl -X GET "http://5.188.140.113:5000/clear"``` -> `int

Очищает базу данных. 
Метод возвращает количество оставшихся в базе данных записей. 

### /
1) ```curl -X GET "http://5.188.140.113:5000/"``` -> `html`

Возвращает "минималистичный" веб-интерфейс для генерации случайных комбинаций мемов.

## Инстанс

В данный момент у нас поднят инстанс на VkCloudSolutions. 
IP: `5.188.140.113`
PORT: `5000`
Доступ по протоколу http

## Самостоятельный билд

(Это сложно, но можно)

Нужен `Python 3.9`


В системе должен быть `python-opencv` и `imagemagick` (можно установаить, например, из репозиториев Ubuntu) 

С используемыми библиотеками есть `requiremts.txt`

Далее нужно поднять `tarantool`, открыв ему 3301 порт, и выполнить в нем команды из файла `tarantool.txt`

Запуск: `python app.py`

## Баги, фишки, особенности реализации
- В базе уже есть несколько случайных мемов, можете ознакомиться с их комбинациями: http://5.188.140.113:5000/?
- Пытается подставить случайный цвет/паттерн (из предложенной пдф-ки) в области с равноменым цветом по краям изображения
- Адаптивно подбирает размер шрифта для вставки на изображение, шрифт VkSans. Цвет всегда черный.
- Использует `Jaro string similarity metric` для подбора подходящего под текст изображения
- Использует `Structure similarity` для подбора "похожего" изображения
- Из-за необходимости использовать imagemagick для подмены фона долго обрабатывает большие картинки
- При подборе "похожего" текста случайно заменяет верхнюю или нижнюю часть на свою мем-фразу
